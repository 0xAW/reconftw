#!/bin/bash

# Default config path
CONFIG_PATH="$RECONFTW_CFG"

# Check if the config file exists
if [ -f "$CONFIG_PATH" ]; then
    source "$CONFIG_PATH"
else
    echo "Error: reconftw.cfg not found at $CONFIG_PATH!"
    exit 1
fi

# Help menu
function help_menu() {
    echo -e "Usage: ./google_dorks_script.sh [OPTIONS]"
    echo -e "Options:"
    echo -e "  -d, --domain DOMAIN       Specify the domain"
    echo -e "  -o, --output FILE         (Optional) Specify the output directory file"
    echo -e "  -h, --help                Display this help menu"
    exit 1
}

# Main function
function google_dorks() {
    output_file_arg=""
    if [ -n "$output" ]; then
        output_file_arg="-o ${output}"
    fi

    python3 "${tools}/dorks_hunter/dorks_hunter.py" -d "$domain" $output_file_arg || { 
        echo -e "${bred}Error: dorks_hunter.py failed.${reset}" >&2; 
        exit 1; 
    }
}

# Parse command-line arguments
domain=""
output_dir=""
while [[ "$#" -gt 0 ]]; do
    case $1 in
        -d|--domain) domain="$2"; shift ;;
        -o|--output) output="$2"; shift ;;
        -h|--help) help_menu ;;
        *) echo -e "${bred}Unknown parameter passed: $1${reset}" >&2; help_menu ;;
    esac
    shift
done

# Validate inputs
if [ -z "$domain" ]; then
    echo -e "${bred}Error: Missing required parameters.${reset}" >&2
    help_menu
    exit 1
fi

# Execute the main function
google_dorks
